# Generated by Django 5.2.9 on 2025-12-17 07:12

import django.db.models.deletion
import uuid
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('contenttypes', '0002_remove_content_type_name'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='ResearchWorkflow',
            fields=[
                ('session_id', models.UUIDField(editable=False, help_text='Unique identifier for the current research workflow session.', primary_key=True, serialize=False)),
                ('current_stage', models.CharField(choices=[('TOPIC_DEFINITION_LOCKIN', 'Topic Definition & Lock-in'), ('EXPLORATION', 'Exploration'), ('FORMULATION', 'Formulation'), ('COLLECTION', 'Collection'), ('PRESENTATION', 'Presentation')], default='TOPIC_DEFINITION_LOCKIN', help_text='Current ISP phase (DEFINITION, EXPLORATION, etc.).', max_length=50)),
                ('is_active', models.BooleanField(default=True, help_text='Indicates if the workflow is currently in progress or concluded.')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('user', models.ForeignKey(help_text='The ID of the user owning this workflow.', on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Research Workflow State',
                'verbose_name_plural': 'Research Workflow States',
            },
        ),
        migrations.CreateModel(
            name='InitiationPhaseData',
            fields=[
                ('workflow', models.OneToOneField(help_text='One-to-one link to the parent ResearchWorkflow (Control Model).', on_delete=django.db.models.deletion.CASCADE, primary_key=True, related_name='initiation_data', serialize=False, to='workflows.researchworkflow')),
                ('stability_score', models.IntegerField(default=0, help_text="The Agent's Stability Score [1-10]. Used to derive clarity label and progress visualization.")),
                ('feasibility_status', models.CharField(default='LOW', help_text='The Feasibility Status (e.g., LOW, MEDIUM, HIGH) derived from Agent input and structural rules.', max_length=10)),
                ('final_research_question', models.TextField(blank=True, default='', help_text='The most refined draft of the research question extracted by the Agent.')),
                ('conversation_summary', models.TextField(blank=True, default='', help_text='The cumulative, incremental summary of the conversation, maintained by the Summarizer Agent (Long-Term Memory).')),
                ('last_analysis_sequence_number', models.IntegerField(default=0, help_text='The sequence number of the last chat message included in the latest structured analysis (TR Agent) or summary (SUM Agent). Serves as the checkpoint anchor for the next incremental operation.')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
            options={
                'verbose_name': 'Initiation Phase Data',
                'verbose_name_plural': 'Initiation Phase Data',
            },
        ),
        migrations.CreateModel(
            name='ChatHistoryEntry',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, help_text="Unique identifier (UUID) for the chat message, corresponding to the frontend's ID.", primary_key=True, serialize=False)),
                ('role', models.CharField(choices=[('user', 'User'), ('system', 'System/Agent')], help_text="The role of the sender ('user' or 'system').", max_length=10)),
                ('content', models.TextField(help_text='The text content of the chat message.')),
                ('name', models.CharField(blank=True, help_text="Specific sender identifier (e.g., username, 'Explorer Agent', 'Data Agent').", max_length=50, null=True)),
                ('timestamp', models.DateTimeField(auto_now_add=True, help_text='The exact time the message was recorded.')),
                ('sequence_number', models.IntegerField(help_text="The sequential order of the message within the workflow's history.")),
                ('workflow', models.ForeignKey(help_text='Foreign key linking the message to the parent research workflow session.', on_delete=django.db.models.deletion.CASCADE, related_name='chat_history_entries', to='workflows.researchworkflow')),
            ],
            options={
                'verbose_name': 'Chat History Entry',
                'verbose_name_plural': 'Chat History Entries',
                'ordering': ['timestamp', 'sequence_number'],
            },
        ),
        migrations.CreateModel(
            name='ReflectionLog',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, help_text='Unique identifier for the reflection entry.', primary_key=True, serialize=False)),
                ('object_id', models.UUIDField(help_text='The UUID of the specific owner instance.')),
                ('title', models.CharField(help_text='A short summary title for the log entry.', max_length=255)),
                ('content', models.TextField(help_text='The detailed reflection content or thought.')),
                ('status', models.CharField(choices=[('DRAFT', 'Draft'), ('COMMITTED', 'Committed')], default='DRAFT', help_text='The current state of the log (DRAFT or COMMITTED).', max_length=10)),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True, help_text='The exact time the log entry was first created.')),
                ('updated_at', models.DateTimeField(auto_now=True, db_index=True, help_text='The time the log entry was last modified/saved.')),
                ('content_type', models.ForeignKey(help_text='The model type of the owner (Workflows, Resources, etc.)', on_delete=django.db.models.deletion.CASCADE, to='contenttypes.contenttype')),
            ],
            options={
                'verbose_name': 'Reflection Log Entry',
                'verbose_name_plural': 'Reflection Log Entries',
                'ordering': ['-updated_at'],
            },
        ),
    ]
